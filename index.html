<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Vibro.x - High-Quality Video Platform</title>
<meta name="description" content="Upload, watch, share and comment on high quality videos.">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/x-icon" href="icon/Vibro.ico?v=1">
<link rel="shortcut icon" type="image/x-icon" href="icon/Vibro.ico?v=1">
<link rel="apple-touch-icon" href="icon/Vibro.ico?v=1">
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Inter Font -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
    --primary: #ff0000;
    --primary-dark: #cc0000;
    --primary-light: #ff3333;
    --secondary: #065fd4;
    --dark-bg: #0f0f0f;
    --dark-surface: #212121;
    --dark-surface-light: #383838;
    --dark-surface-hover: #4d4d4d;
    --text-primary: #ffffff;
    --text-secondary: #aaaaaa;
    --text-tertiary: #717171;
    --border-color: #303030;
    --success: #2ecc71;
    --danger: #e74c3c;
    --warning: #f39c12;
    --info: #3498db;
    --shadow-sm: 0 1px 2px rgba(0,0,0,0.3);
    --shadow-md: 0 4px 6px rgba(0,0,0,0.4);
    --shadow-lg: 0 10px 25px rgba(0,0,0,0.5);
    --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    --border-radius: 12px;
    --border-radius-sm: 8px;
    --border-radius-full: 9999px;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    cursor: none !important; /* Hide default cursor */
}

/* Custom Cursor */
.custom-cursor {
    position: fixed;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    pointer-events: none;
    z-index: 9999;
    mix-blend-mode: difference;
    transition: transform 0.15s ease, background-color 0.3s ease;
    transform: translate(-50%, -50%);
}

.cursor-dot {
    width: 6px;
    height: 6px;
    background-color: var(--primary);
}

.cursor-outline {
    width: 40px;
    height: 40px;
    border: 2px solid var(--primary);
    transition: all 0.1s ease;
}

.cursor-click {
    animation: clickEffect 0.3s ease;
}

@keyframes clickEffect {
    0% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
    }
    50% {
        transform: translate(-50%, -50%) scale(1.5);
        opacity: 0.5;
    }
    100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
    }
}

/* Color change animation for cursor */
@keyframes cursorColorShift {
    0% { background-color: #ff0000; }
    25% { background-color: #065fd4; }
    50% { background-color: #2ecc71; }
    75% { background-color: #f39c12; }
    100% { background-color: #ff0000; }
}

.cursor-dot.color-shift {
    animation: cursorColorShift 8s infinite linear;
}

/* Cursor color by area */
.cursor-dot.header-area { background-color: #ff0000; }
.cursor-dot.sidebar-area { background-color: #065fd4; }
.cursor-dot.video-area { background-color: #2ecc71; }
.cursor-dot.upload-area { background-color: #f39c12; }
.cursor-dot.modal-area { background-color: #9b59b6; }

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
    background-color: var(--dark-bg);
    color: var(--text-primary);
    line-height: 1.6;
    overflow-x: hidden;
    cursor: none !important;
}

/* Smooth scroll */
html {
    scroll-behavior: smooth;
}

/* Header Styles with animation */
.header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 56px;
    background-color: rgba(33, 33, 33, 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    padding: 0 16px;
    z-index: 1000;
    gap: 24px;
    transform: translateY(0);
    transition: transform 0.3s ease, background-color 0.3s ease;
}

.header.hidden {
    transform: translateY(-100%);
}

.logo {
    display: flex;
    align-items: center;
    gap: 4px;
    font-weight: 700;
    font-size: 20px;
    color: var(--text-primary);
    text-decoration: none;
    transition: var(--transition);
    position: relative;
    overflow: hidden;
}

.logo::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--primary);
    transition: width 0.3s ease;
}

.logo:hover::after {
    width: 100%;
}

.logo-icon {
    color: var(--primary);
    transition: transform 0.3s ease;
}

.logo:hover .logo-icon {
    transform: rotate(15deg);
}

.search-container {
    flex: 1;
    max-width: 650px;
    position: relative;
}

.search-bar {
    display: flex;
    height: 40px;
    border-radius: var(--border-radius-full);
    overflow: hidden;
    border: 1px solid var(--border-color);
    background: var(--dark-bg);
    transition: var(--transition);
    position: relative;
}

.search-bar:focus-within {
    border-color: var(--primary);
    box-shadow: 0 0 0 2px rgba(255, 0, 0, 0.1);
    transform: translateY(-1px);
}

.search-input {
    flex: 1;
    padding: 0 16px;
    background: transparent;
    border: none;
    color: var(--text-primary);
    font-size: 16px;
    outline: none;
    transition: var(--transition);
}

.search-input::placeholder {
    color: var(--text-tertiary);
}

.search-button {
    width: 64px;
    background: var(--dark-surface-light);
    border: none;
    color: var(--text-secondary);
    cursor: none;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
    position: relative;
    overflow: hidden;
}

.search-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
    transition: left 0.5s ease;
}

.search-button:hover::before {
    left: 100%;
}

.search-button:hover {
    background: var(--dark-surface-hover);
    color: var(--primary);
}

.header-actions {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-left: auto;
}

.upload-btn {
    background: linear-gradient(45deg, var(--primary), var(--primary-dark));
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: var(--border-radius-full);
    font-weight: 500;
    cursor: none;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.upload-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
}

.upload-btn:hover::before {
    width: 300px;
    height: 300px;
}

.upload-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(255, 0, 0, 0.3);
}

.user-menu {
    position: relative;
}

.user-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    cursor: none;
    border: 2px solid transparent;
    transition: var(--transition);
    object-fit: cover;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
}

.user-avatar:hover {
    border-color: var(--primary);
    transform: scale(1.1);
}

.user-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 8px;
    width: 220px;
    background: var(--dark-surface);
    border-radius: var(--border-radius-sm);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--border-color);
    display: none;
    z-index: 1001;
    overflow: hidden;
    transform-origin: top right;
    animation: dropdownAppear 0.2s ease;
}

@keyframes dropdownAppear {
    from {
        opacity: 0;
        transform: scale(0.95) translateY(-10px);
    }
    to {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

.user-dropdown.show {
    display: block;
}

.dropdown-header {
    padding: 16px;
    border-bottom: 1px solid var(--border-color);
    background: var(--dark-surface-light);
}

.dropdown-header h3 {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 4px;
}

.dropdown-header p {
    font-size: 13px;
    color: var(--text-secondary);
}

.dropdown-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    color: var(--text-primary);
    text-decoration: none;
    transition: var(--transition);
    cursor: none;
    border: none;
    background: none;
    width: 100%;
    text-align: left;
    font-size: 14px;
    position: relative;
    overflow: hidden;
}

.dropdown-item::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 0;
    background: var(--primary);
    transition: width 0.3s ease;
    z-index: -1;
}

.dropdown-item:hover::before {
    width: 100%;
}

.dropdown-item:hover {
    color: white;
    padding-left: 24px;
}

.dropdown-item i {
    width: 20px;
    color: var(--text-secondary);
    transition: var(--transition);
}

.dropdown-item:hover i {
    color: white;
}

/* Main Content */
.main-container {
    display: flex;
    margin-top: 56px;
    min-height: calc(100vh - 56px);
}

/* Sidebar with gradient border */
.sidebar {
    width: 240px;
    background: var(--dark-surface);
    border-right: 1px solid var(--border-color);
    padding: 12px 0;
    position: fixed;
    top: 56px;
    left: 0;
    bottom: 0;
    overflow-y: auto;
    z-index: 999;
    transition: transform 0.3s ease;
}

.sidebar::-webkit-scrollbar {
    width: 6px;
}

.sidebar::-webkit-scrollbar-track {
    background: var(--dark-bg);
}

.sidebar::-webkit-scrollbar-thumb {
    background: var(--dark-surface-hover);
    border-radius: 3px;
}

.sidebar-item {
    display: flex;
    align-items: center;
    gap: 24px;
    padding: 12px 24px;
    color: var(--text-primary);
    text-decoration: none;
    transition: all 0.3s ease;
    cursor: none;
    border-radius: var(--border-radius-sm);
    margin: 0 12px 4px;
    position: relative;
    overflow: hidden;
}

.sidebar-item::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    width: 4px;
    background: var(--primary);
    transform: translateX(-100%);
    transition: transform 0.3s ease;
}

.sidebar-item:hover {
    background: var(--dark-surface-light);
    padding-left: 32px;
}

.sidebar-item:hover::before {
    transform: translateX(0);
}

.sidebar-item.active {
    background: var(--dark-surface-light);
    font-weight: 500;
    color: var(--primary);
    padding-left: 32px;
}

.sidebar-item.active::before {
    transform: translateX(0);
}

.sidebar-item i {
    width: 24px;
    text-align: center;
    transition: transform 0.3s ease;
}

.sidebar-item:hover i {
    transform: scale(1.2);
}

.main-content {
    flex: 1;
    margin-left: 240px;
    padding: 24px;
    transition: margin-left 0.3s ease;
}

/* Upload Section */
.upload-container {
    max-width: 800px;
    margin: 0 auto;
    background: var(--dark-surface);
    border-radius: var(--border-radius);
    padding: 32px;
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--border-color);
    animation: slideUp 0.4s ease;
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.upload-container h2 {
    font-size: 24px;
    margin-bottom: 24px;
    color: var(--text-primary);
    position: relative;
    display: inline-block;
}

.upload-container h2::after {
    content: '';
    position: absolute;
    bottom: -8px;
    left: 0;
    width: 60px;
    height: 3px;
    background: var(--primary);
    border-radius: 2px;
}

.upload-area {
    border: 2px dashed var(--border-color);
    border-radius: var(--border-radius);
    padding: 48px 32px;
    text-align: center;
    margin-bottom: 24px;
    transition: all 0.3s ease;
    cursor: none;
    position: relative;
    overflow: hidden;
}

.upload-area::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, transparent 30%, rgba(255, 0, 0, 0.05) 50%, transparent 70%);
    transform: translateX(-100%);
    transition: transform 1s ease;
}

.upload-area:hover::before {
    transform: translateX(100%);
}

.upload-area:hover {
    border-color: var(--primary);
    background: rgba(255, 0, 0, 0.03);
    transform: translateY(-2px);
}

.upload-area.dragover {
    border-color: var(--primary);
    background: rgba(255, 0, 0, 0.1);
    transform: scale(0.98);
}

.upload-icon {
    font-size: 48px;
    color: var(--primary);
    margin-bottom: 16px;
    animation: float 3s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.file-info {
    background: var(--dark-bg);
    border-radius: var(--border-radius-sm);
    padding: 16px;
    margin-bottom: 16px;
    border-left: 4px solid var(--primary);
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.form-group {
    margin-bottom: 20px;
    animation: fadeInUp 0.4s ease;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: var(--text-primary);
}

.form-group input,
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 12px 16px;
    background: var(--dark-bg);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius-sm);
    color: var(--text-primary);
    font-size: 14px;
    transition: var(--transition);
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 2px rgba(255, 0, 0, 0.1);
    transform: translateY(-1px);
}

.form-group textarea {
    min-height: 100px;
    resize: vertical;
}

.form-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
}

.checkbox-group {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    margin-top: 8px;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: none;
    font-size: 14px;
    transition: var(--transition);
}

.checkbox-label:hover {
    color: var(--primary);
}

.checkbox-label input {
    width: auto;
}

.upload-actions {
    display: flex;
    gap: 12px;
    margin-top: 32px;
}

.btn-primary {
    background: linear-gradient(45deg, var(--primary), var(--primary-dark));
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: var(--border-radius-sm);
    font-weight: 500;
    cursor: none;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    position: relative;
    overflow: hidden;
}

.btn-primary::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
}

.btn-primary:hover::before {
    width: 300px;
    height: 300px;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(255, 0, 0, 0.3);
}

.btn-secondary {
    background: var(--dark-surface-light);
    color: var(--text-primary);
    border: none;
    padding: 12px 24px;
    border-radius: var(--border-radius-sm);
    font-weight: 500;
    cursor: none;
    transition: all 0.3s ease;
}

.btn-secondary:hover {
    background: var(--dark-surface-hover);
    transform: translateY(-2px);
}

/* Videos Grid with hover effects */
.videos-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 24px;
    margin-top: 24px;
}

.video-card {
    background: var(--dark-surface);
    border-radius: var(--border-radius);
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: none;
    border: 1px solid var(--border-color);
    position: relative;
}

.video-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, transparent 30%, rgba(255, 0, 0, 0.03) 50%, transparent 70%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.video-card:hover::before {
    opacity: 1;
}

.video-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
    border-color: var(--primary);
}

.video-thumbnail {
    position: relative;
    aspect-ratio: 16 / 9;
    overflow: hidden;
}

.video-thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: all 0.6s ease;
}

.video-card:hover .video-thumbnail img {
    transform: scale(1.1);
    filter: brightness(1.1);
}

.video-duration {
    position: absolute;
    bottom: 8px;
    right: 8px;
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
    backdrop-filter: blur(4px);
}

.video-info {
    padding: 12px;
    display: flex;
    gap: 12px;
}

.channel-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    object-fit: cover;
    flex-shrink: 0;
    border: 2px solid transparent;
    transition: border-color 0.3s ease;
}

.video-card:hover .channel-avatar {
    border-color: var(--primary);
}

.video-content {
    flex: 1;
    min-width: 0;
}

.video-title {
    font-weight: 500;
    margin-bottom: 8px;
    line-height: 1.4;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    transition: color 0.3s ease;
}

.video-card:hover .video-title {
    color: var(--primary);
}

.channel-name {
    font-size: 14px;
    color: var(--text-secondary);
    margin-bottom: 4px;
    transition: color 0.3s ease;
}

.video-card:hover .channel-name {
    color: var(--text-primary);
}

.video-stats {
    font-size: 14px;
    color: var(--text-tertiary);
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

/* Video Player Modal - FIXED SCROLLBAR ISSUE */
.video-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.98);
    z-index: 2000;
    display: none;
    overflow: hidden;
    animation: modalFadeIn 0.3s ease;
}

@keyframes modalFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.video-modal.show {
    display: flex;
}

.modal-content {
    max-width: 1400px;
    margin: 0 auto;
    padding: 24px;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.modal-header {
    display: flex;
    justify-content: flex-end;
    margin-bottom: 16px;
    flex-shrink: 0;
}

.close-modal {
    background: var(--dark-surface);
    border: none;
    color: var(--text-primary);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: none;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.close-modal::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    transform: translate(-50%, -50%);
    transition: width 0.3s, height 0.3s;
}

.close-modal:hover::before {
    width: 100%;
    height: 100%;
}

.close-modal:hover {
    background: var(--primary);
    transform: rotate(90deg);
}

.modal-body {
    display: flex;
    gap: 24px;
    flex: 1;
    overflow: hidden;
    height: calc(100vh - 120px);
}

.video-player-container {
    flex: 3;
    min-width: 0;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.video-player {
    width: 100%;
    aspect-ratio: 16 / 9;
    background: #000;
    border-radius: var(--border-radius);
    overflow: hidden;
    flex-shrink: 0;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
}

.video-details {
    background: var(--dark-surface);
    border-radius: var(--border-radius);
    padding: 20px;
    margin-top: 16px;
    flex-shrink: 0;
    border-left: 4px solid var(--primary);
}

.video-title-large {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 12px;
    line-height: 1.4;
}

.video-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 12px;
}

.video-views {
    font-size: 14px;
    color: var(--text-tertiary);
}

.video-actions-bar {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.action-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: var(--dark-surface-light);
    border: none;
    border-radius: var(--border-radius-full);
    color: var(--text-primary);
    cursor: none;
    transition: all 0.3s ease;
    font-size: 14px;
    font-weight: 500;
    white-space: nowrap;
    position: relative;
    overflow: hidden;
}

.action-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
    transition: left 0.5s ease;
}

.action-btn:hover::before {
    left: 100%;
}

.action-btn:hover {
    background: var(--dark-surface-hover);
    transform: translateY(-2px);
}

.action-btn.liked {
    color: var(--primary);
    background: rgba(255, 0, 0, 0.1);
}

.video-description {
    background: var(--dark-surface-light);
    border-radius: var(--border-radius-sm);
    padding: 16px;
    margin-top: 16px;
    position: relative;
    overflow: hidden;
}

.description-toggle {
    color: var(--text-secondary);
    background: none;
    border: none;
    cursor: none;
    font-weight: 500;
    padding: 4px 0;
    margin-top: 8px;
    display: inline-block;
    transition: color 0.3s ease;
    position: relative;
}

.description-toggle::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 1px;
    background: var(--primary);
    transition: width 0.3s ease;
}

.description-toggle:hover::after {
    width: 100%;
}

.description-toggle:hover {
    color: var(--primary);
}

/* Comments Section - FIXED SCROLLBAR */
.comments-section {
    background: var(--dark-surface);
    border-radius: var(--border-radius);
    padding: 20px;
    margin-top: 16px;
    flex: 1;
    min-height: 400px;
    max-height: 600px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    border-left: 4px solid var(--info);
}

.comments-header {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 24px;
    flex-shrink: 0;
}

.comments-count {
    font-size: 18px;
    font-weight: 600;
    position: relative;
}

.comments-count::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 40px;
    height: 2px;
    background: var(--info);
}

.comments-sort {
    background: var(--dark-surface-light);
    border: 1px solid var(--border-color);
    color: var(--text-primary);
    padding: 8px 16px;
    border-radius: var(--border-radius-full);
    cursor: none;
    font-size: 14px;
    transition: var(--transition);
}

.comments-sort:hover {
    border-color: var(--info);
}

.comment-form {
    display: flex;
    gap: 12px;
    margin-bottom: 24px;
    flex-shrink: 0;
}

.comment-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
    flex-shrink: 0;
    border: 2px solid transparent;
    transition: border-color 0.3s ease;
}

.comment-avatar:hover {
    border-color: var(--info);
}

.comment-input-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.comment-input {
    width: 100%;
    padding: 12px 16px;
    background: var(--dark-bg);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius-full);
    color: var(--text-primary);
    font-size: 14px;
    outline: none;
    transition: var(--transition);
    font-family: inherit;
}

.comment-input:focus {
    border-color: var(--info);
    box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1);
}

.comment-submit {
    background: var(--info);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: var(--border-radius-full);
    font-weight: 500;
    cursor: none;
    transition: all 0.3s ease;
    align-self: flex-end;
    min-width: 100px;
    position: relative;
    overflow: hidden;
}

.comment-submit::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
}

.comment-submit:hover::before {
    width: 300px;
    height: 300px;
}

.comment-submit:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
}

.comment-submit:disabled {
    background: var(--dark-surface-light);
    cursor: not-allowed;
    opacity: 0.5;
}

.comments-list {
    flex: 1;
    overflow-y: auto;
    padding-right: 8px;
    max-height: 400px;
}

/* Custom scrollbar - FIXED */
.comments-list::-webkit-scrollbar {
    width: 8px;
}

.comments-list::-webkit-scrollbar-track {
    background: var(--dark-surface-light);
    border-radius: 4px;
}

.comments-list::-webkit-scrollbar-thumb {
    background: var(--dark-surface-hover);
    border-radius: 4px;
    transition: background 0.3s ease;
}

.comments-list::-webkit-scrollbar-thumb:hover {
    background: var(--info);
}

.comment-item {
    display: flex;
    gap: 16px;
    padding: 16px 0;
    border-bottom: 1px solid var(--border-color);
    animation: slideInRight 0.3s ease;
}

@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateX(20px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.comment-item:last-child {
    border-bottom: none;
}

.comment-content {
    flex: 1;
}

.comment-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
    flex-wrap: wrap;
}

.comment-author {
    font-weight: 500;
    font-size: 14px;
    color: var(--text-primary);
    transition: color 0.3s ease;
}

.comment-author:hover {
    color: var(--info);
}

.comment-time {
    color: var(--text-tertiary);
    font-size: 12px;
}

.comment-text {
    font-size: 14px;
    line-height: 1.5;
    margin-bottom: 8px;
    color: var(--text-primary);
    word-break: break-word;
}

.comment-actions {
    display: flex;
    gap: 16px;
    align-items: center;
    margin-top: 8px;
}

.comment-like {
    display: flex;
    align-items: center;
    gap: 6px;
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: none;
    font-size: 12px;
    padding: 4px 8px;
    border-radius: var(--border-radius-full);
    transition: all 0.3s ease;
}

.comment-like:hover {
    background: var(--dark-surface-light);
    transform: scale(1.1);
}

.comment-like.liked {
    color: var(--info);
    background: rgba(52, 152, 219, 0.1);
}

.comment-reply {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: none;
    font-size: 12px;
    padding: 4px 8px;
    border-radius: var(--border-radius-full);
    transition: all 0.3s ease;
}

.comment-reply:hover {
    background: var(--dark-surface-light);
    transform: scale(1.1);
}

.replies-container {
    margin-left: 40px;
    margin-top: 12px;
    padding-left: 16px;
    border-left: 2px solid var(--border-color);
}

.load-more-comments {
    text-align: center;
    margin-top: 16px;
    flex-shrink: 0;
}

.load-more-btn {
    background: var(--dark-surface-light);
    border: none;
    color: var(--text-primary);
    padding: 12px 24px;
    border-radius: var(--border-radius-full);
    cursor: none;
    font-weight: 500;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin: 0 auto;
    position: relative;
    overflow: hidden;
}

.load-more-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
    transition: left 0.5s ease;
}

.load-more-btn:hover::before {
    left: 100%;
}

.load-more-btn:hover {
    background: var(--dark-surface-hover);
    transform: translateY(-2px);
}

.video-sidebar {
    flex: 1;
    min-width: 300px;
    overflow-y: auto;
    height: 100%;
}

.video-sidebar::-webkit-scrollbar {
    width: 6px;
}

.video-sidebar::-webkit-scrollbar-track {
    background: var(--dark-surface-light);
}

.video-sidebar::-webkit-scrollbar-thumb {
    background: var(--dark-surface-hover);
    border-radius: 3px;
}

/* Notifications with animations */
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 16px 24px;
    border-radius: var(--border-radius-sm);
    background: var(--dark-surface);
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow-lg);
    z-index: 3000;
    display: none;
    align-items: center;
    gap: 12px;
    max-width: 400px;
    animation: slideInRight 0.3s ease;
    backdrop-filter: blur(10px);
}

.notification.show {
    display: flex;
}

.notification.success {
    border-left: 4px solid var(--success);
}

.notification.error {
    border-left: 4px solid var(--danger);
}

.notification.info {
    border-left: 4px solid var(--info);
}

/* Loading States */
.loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 48px;
    gap: 16px;
}

.loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid var(--border-color);
    border-top-color: var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

/* Glow effects for interactive elements */
.glow-on-hover {
    position: relative;
}

.glow-on-hover::after {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: linear-gradient(45deg, var(--primary), var(--secondary), var(--success), var(--warning));
    border-radius: inherit;
    z-index: -1;
    opacity: 0;
    filter: blur(10px);
    transition: opacity 0.3s ease;
}

.glow-on-hover:hover::after {
    opacity: 0.5;
}

/* Pulse animation for new content */
@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.4); }
    70% { box-shadow: 0 0 0 10px rgba(255, 0, 0, 0); }
    100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); }
}

.pulse {
    animation: pulse 2s infinite;
}

/* Shimmer effect for loading */
.shimmer {
    background: linear-gradient(
        90deg,
        var(--dark-surface-light) 0%,
        var(--dark-surface-hover) 50%,
        var(--dark-surface-light) 100%
    );
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
}

@keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
}

/* Responsive Design for Mobile */
@media (max-width: 1200px) {
    .sidebar {
        width: 72px;
    }
    
    .sidebar-item span {
        display: none;
    }
    
    .main-content {
        margin-left: 72px;
    }
    
    .modal-body {
        flex-direction: column;
        height: auto;
    }
    
    .video-sidebar {
        min-width: 100%;
        max-height: 400px;
    }
}

@media (max-width: 768px) {
    .header {
        padding: 0 12px;
        gap: 16px;
    }
    
    .search-container {
        flex: 1;
        display: block !important;
    }
    
    .videos-grid {
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 16px;
    }
    
    .upload-container {
        padding: 24px;
        margin: 0 16px;
    }
    
    .modal-content {
        padding: 16px;
    }
    
    .modal-body {
        flex-direction: column;
        gap: 16px;
        height: auto;
    }
    
    .video-actions-bar {
        flex-wrap: wrap;
    }
    
    .comment-form {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .comment-input-container {
        width: 100%;
    }
    
    .comment-submit {
        align-self: flex-end;
    }
    
    .comments-section {
        max-height: 500px;
    }
    
    .sidebar {
        width: 60px;
    }
    
    .main-content {
        margin-left: 60px;
        padding: 16px;
    }
    
    /* Disable custom cursor on mobile */
    .custom-cursor {
        display: none;
    }
    
    * {
        cursor: auto !important;
    }
}

@media (max-width: 480px) {
    .sidebar {
        display: none;
    }
    
    .main-content {
        margin-left: 0;
        padding: 16px;
    }
    
    .videos-grid {
        grid-template-columns: 1fr;
    }
    
    .modal-body {
        gap: 16px;
    }
    
    .video-sidebar {
        display: none;
    }
    
    .video-player-container {
        flex: 1;
    }
    
    .header-actions .upload-btn span {
        display: none;
    }
    
    .search-container {
        margin: 0 8px;
    }
    
    /* Disable custom cursor on mobile */
    .custom-cursor {
        display: none;
    }
    
    * {
        cursor: auto !important;
    }
}

/* Mobile-specific autoplay styles */
@media (hover: none) and (pointer: coarse) {
    .video-card:hover {
        transform: none;
        box-shadow: var(--shadow-sm);
    }
    
    .video-card .video-thumbnail img {
        transition: none;
    }
}

/* Mobile video hover effect override */
@media (hover: hover) {
    .video-card:hover .video-thumbnail img {
        transform: scale(1.05);
    }
}

/* Mobile touch feedback */
@media (max-width: 768px) {
    .video-card:active {
        transform: scale(0.98);
        transition: transform 0.1s ease;
    }
}

/* Empty state */
.empty-state {
    grid-column: 1 / -1;
    text-align: center;
    padding: 48px;
    color: var(--text-tertiary);
}

.empty-state i {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
    animation: float 3s ease-in-out infinite;
}

.empty-state h3 {
    font-size: 20px;
    margin-bottom: 8px;
    color: var(--text-secondary);
}

.empty-state p {
    font-size: 14px;
    max-width: 400px;
    margin: 0 auto;
}

/* Neon text effect */
.neon-text {
    color: #fff;
    text-shadow:
        0 0 5px currentColor,
        0 0 10px currentColor,
        0 0 20px currentColor,
        0 0 40px var(--primary),
        0 0 80px var(--primary);
    animation: neonPulse 2s infinite alternate;
}

@keyframes neonPulse {
    from {
        text-shadow:
            0 0 5px currentColor,
            0 0 10px currentColor,
            0 0 20px currentColor,
            0 0 40px var(--primary),
            0 0 80px var(--primary);
    }
    to {
        text-shadow:
            0 0 10px currentColor,
            0 0 20px currentColor,
            0 0 40px currentColor,
            0 0 80px var(--primary),
            0 0 160px var(--primary);
    }
}

/* Gradient text */
.gradient-text {
    background: linear-gradient(45deg, var(--primary), var(--secondary), var(--success));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* Parallax effect for video cards */
.parallax-card {
    transform-style: preserve-3d;
    perspective: 1000px;
}

.parallax-card:hover .video-thumbnail img {
    transform: translateZ(20px) scale(1.1);
}

/* Page transitions */
.page-transition {
    animation: pageFadeIn 0.5s ease;
}

@keyframes pageFadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
</style>
</head>
<body>

<!-- Custom Cursor -->
<div class="custom-cursor cursor-dot"></div>
<div class="custom-cursor cursor-outline"></div>

<!-- Header -->
<header class="header">
    <a href="#" class="logo" id="logoBtn">
        <i class="fas fa-play-circle logo-icon"></i>
        <span>Vibro.x</span>
    </a>
    
    <div class="search-container">
        <div class="search-bar">
            <input type="text" class="search-input" placeholder="Search videos..." id="searchInput">
            <button class="search-button" id="searchButton">
                <i class="fas fa-search"></i>
            </button>
        </div>
    </div>
    
    <div class="header-actions">
        <button class="upload-btn" id="uploadBtn">
            <i class="fas fa-upload"></i>
            <span>Upload</span>
        </button>
        
        <div class="user-menu">
            <img src="https://ui-avatars.com/api/?name=User&background=random" 
                 alt="User" 
                 class="user-avatar" 
                 id="userAvatar">
            
            <div class="user-dropdown" id="userDropdown">
                <div class="dropdown-header" id="dropdownHeader">
                    <h3>Guest User</h3>
                    <p>Sign in to upload videos</p>
                </div>
                <button class="dropdown-item" id="loginBtn">
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Sign In</span>
                </button>
                <button class="dropdown-item" id="logoutBtn" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </button>
                <button class="dropdown-item" id="settingsBtn">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </button>
            </div>
        </div>
    </div>
</header>

<!-- Sidebar -->
<nav class="sidebar">
    <a href="#" class="sidebar-item active" id="homeBtn">
        <i class="fas fa-home"></i>
        <span>Home</span>
    </a>
    <a href="#" class="sidebar-item" id="trendingBtn">
        <i class="fas fa-fire"></i>
        <span>Trending</span>
    </a>
    <a href="#" class="sidebar-item" id="historyBtn">
        <i class="fas fa-history"></i>
        <span>History</span>
    </a>
    <a href="#" class="sidebar-item" id="likedBtn">
        <i class="fas fa-thumbs-up"></i>
        <span>Liked videos</span>
    </a>
    <a href="#" class="sidebar-item" id="yourVideosBtn">
        <i class="fas fa-play-circle"></i>
        <span>Your videos</span>
    </a>
    <a href="#" class="sidebar-item" id="watchLaterBtn">
        <i class="fas fa-clock"></i>
        <span>Watch later</span>
    </a>
</nav>

<!-- Main Content -->
<main class="main-container">
    <div class="main-content page-transition">
        <!-- Upload Section (Hidden by default) -->
        <div class="upload-container" id="uploadSection" style="display: none;">
            <h2 class="gradient-text">Upload Video</h2>
            
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <h3>Select video to upload</h3>
                <p>or drag and drop video file</p>
                <p class="text-tertiary">MP4, WebM, MOV up to 500MB</p>
                <button class="btn-primary" id="selectFileBtn">
                    <i class="fas fa-file-video"></i>
                    Select Files
                </button>
            </div>
            
            <input type="file" id="videoFile" accept="video/*" style="display: none;">
            <input type="file" id="coverFile" accept="image/*" style="display: none;">
            
            <div id="fileInfo" class="file-info" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h4 id="fileName"></h4>
                        <p id="fileSize" class="text-tertiary"></p>
                    </div>
                    <button class="btn-secondary" id="clearFileBtn">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <form id="uploadForm">
                <div class="form-group">
                    <label for="videoTitle">Title *</label>
                    <input type="text" id="videoTitle" placeholder="Enter video title" required>
                </div>
                
                <div class="form-group">
                    <label for="videoDescription">Description</label>
                    <textarea id="videoDescription" placeholder="Tell viewers about your video"></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="videoCategory">Category</label>
                        <select id="videoCategory">
                            <option value="">Select category</option>
                            <option value="entertainment">Entertainment</option>
                            <option value="music">Music</option>
                            <option value="gaming">Gaming</option>
                            <option value="education">Education</option>
                            <option value="sports">Sports</option>
                            <option value="tech">Technology</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="videoPrivacy">Privacy</label>
                        <select id="videoPrivacy">
                            <option value="public">Public</option>
                            <option value="unlisted">Unlisted</option>
                            <option value="private">Private</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Tags (comma separated)</label>
                    <input type="text" id="videoTags" placeholder="e.g., gaming, tutorial, vlog">
                </div>
                
                <div class="form-group">
                    <label>Video Settings</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="allowComments" checked>
                            <span>Allow comments</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="allowRatings" checked>
                            <span>Allow ratings</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="showViewCount" checked>
                            <span>Show view count</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="aiGenerated">
                            <span>AI Generated</span>
                        </label>
                    </div>
                </div>
                
                <div class="upload-actions">
                    <button type="submit" class="btn-primary" id="submitUploadBtn">
                        <i class="fas fa-upload"></i>
                        Upload Video
                    </button>
                    <button type="button" class="btn-secondary" id="cancelUploadBtn">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
        
        <!-- Videos Grid -->
        <div id="videosSection">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h2 class="gradient-text">Recommended Videos</h2>
                <div>
                    <select id="sortVideos" class="comments-sort">
                        <option value="newest">Newest first</option>
                        <option value="popular">Most popular</option>
                        <option value="oldest">Oldest first</option>
                    </select>
                </div>
            </div>
            
            <div class="videos-grid" id="videosList">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading videos...</p>
                </div>
            </div>
            
            <div class="load-more-comments" id="loadMoreContainer" style="display: none;">
                <button class="load-more-btn" id="loadMoreBtn">
                    <i class="fas fa-redo"></i>
                    Load More Videos
                </button>
            </div>
        </div>
    </div>
</main>

<!-- Video Player Modal -->
<div class="video-modal" id="videoModal">
    <div class="modal-content">
        <div class="modal-header">
            <button class="close-modal" id="closeModalBtn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="video-player-container">
                <video class="video-player" id="modalVideo" controls playsinline>
                    Your browser does not support the video tag.
                </video>
                
                <div class="video-details">
                    <h1 class="video-title-large gradient-text" id="modalVideoTitle"></h1>
                    
                    <div class="video-meta">
                        <div class="video-views" id="modalVideoMeta"></div>
                        <div class="video-actions-bar">
                            <button class="action-btn" id="likeBtn">
                                <i class="far fa-thumbs-up"></i>
                                <span id="likeCount">0</span>
                            </button>
                            <button class="action-btn" id="shareBtn">
                                <i class="fas fa-share"></i>
                                <span>Share</span>
                            </button>
                            <button class="action-btn" id="saveBtn">
                                <i class="far fa-bookmark"></i>
                                <span>Save</span>
                            </button>
                            <button class="action-btn" id="reportBtn">
                                <i class="fas fa-flag"></i>
                                <span>Report</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="video-description">
                        <div id="videoDescriptionShort"></div>
                        <div id="videoDescriptionFull" style="display: none;"></div>
                        <button class="description-toggle" id="descriptionToggleBtn">
                            Show more
                        </button>
                    </div>
                </div>
                
                <!-- YouTube-style Comments Section -->
                <div class="comments-section" id="commentsSection">
                    <div class="comments-header">
                        <h3 class="comments-count" id="commentsCount">Comments</h3>
                        <select class="comments-sort" id="commentsSort">
                            <option value="newest">Newest first</option>
                            <option value="top">Top comments</option>
                            <option value="oldest">Oldest first</option>
                        </select>
                    </div>
                    
                    <div class="comment-form" id="commentForm">
                        <img src="https://ui-avatars.com/api/?name=User&background=random" 
                             alt="Your avatar" 
                             class="comment-avatar"
                             id="commentAvatar">
                        <div class="comment-input-container">
                            <input type="text" 
                                   class="comment-input" 
                                   id="commentInput" 
                                   placeholder="Add a comment...">
                            <button class="comment-submit" id="commentSubmitBtn">
                                Comment
                            </button>
                        </div>
                    </div>
                    
                    <div class="comments-list" id="commentsList">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <p>Loading comments...</p>
                        </div>
                    </div>
                    
                    <div class="load-more-comments" id="loadMoreComments" style="display: none;">
                        <button class="load-more-btn" id="loadMoreCommentsBtn">
                            Load more comments
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="video-sidebar" id="recommendedVideos">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading recommendations...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Notifications -->
<div class="notification" id="notification"></div>

<script>
// =============== GLOBAL STATE ===============
let currentUser = null;
let currentVideo = null;
let videosCache = [];
let commentsCache = {};
let displayedVideos = 0;
let pollingInterval = null;
let lastUpdateCheck = Date.now();
let observer = null;
let isMobile = /iPhone|iPad|Android/i.test(navigator.userAgent);
let lastScrollTop = 0;
const VIDEOS_PER_PAGE = 12;
const COMMENTS_PER_PAGE = 20;
const POLLING_INTERVAL = 3000; // 3 seconds

// =============== CUSTOM CURSOR ===============
let mouseX = 0;
let mouseY = 0;
let cursorX = 0;
let cursorY = 0;
let cursorOutlineX = 0;
let cursorOutlineY = 0;
let cursorArea = 'header-area';

const cursorDot = document.querySelector('.cursor-dot');
const cursorOutline = document.querySelector('.cursor-outline');

function updateCursor() {
    cursorX += (mouseX - cursorX) * 0.1;
    cursorY += (mouseY - cursorY) * 0.1;
    cursorOutlineX += (mouseX - cursorOutlineX) * 0.05;
    cursorOutlineY += (mouseY - cursorOutlineY) * 0.05;

    cursorDot.style.left = cursorX + 'px';
    cursorDot.style.top = cursorY + 'px';
    cursorOutline.style.left = cursorOutlineX + 'px';
    cursorOutline.style.top = cursorOutlineY + 'px';
}

function handleMouseMove(e) {
    mouseX = e.clientX;
    mouseY = e.clientY;
    
    // Detect cursor area
    const target = e.target;
    if (target.closest('.header')) {
        cursorArea = 'header-area';
    } else if (target.closest('.sidebar')) {
        cursorArea = 'sidebar-area';
    } else if (target.closest('.video-card') || target.closest('.video-player')) {
        cursorArea = 'video-area';
    } else if (target.closest('.upload-container')) {
        cursorArea = 'upload-area';
    } else if (target.closest('.video-modal')) {
        cursorArea = 'modal-area';
    } else {
        cursorArea = 'default';
    }
    
    cursorDot.className = `custom-cursor cursor-dot ${cursorArea}`;
    
    // Add color shift effect
    if (!cursorDot.classList.contains('color-shift')) {
        cursorDot.classList.add('color-shift');
    }
}

function handleMouseDown() {
    cursorDot.classList.add('cursor-click');
    cursorOutline.style.transform = 'translate(-50%, -50%) scale(0.8)';
}

function handleMouseUp() {
    cursorOutline.style.transform = 'translate(-50%, -50%) scale(1)';
    setTimeout(() => {
        cursorDot.classList.remove('cursor-click');
    }, 300);
}

function handleMouseEnter(e) {
    if (e.target.matches('button, a, input, select, textarea, .video-card, .sidebar-item, .action-btn')) {
        cursorOutline.style.transform = 'translate(-50%, -50%) scale(1.5)';
        cursorOutline.style.borderColor = getComputedStyle(document.documentElement).getPropertyValue('--primary');
    }
}

function handleMouseLeave(e) {
    if (e.target.matches('button, a, input, select, textarea, .video-card, .sidebar-item, .action-btn')) {
        cursorOutline.style.transform = 'translate(-50%, -50%) scale(1)';
        cursorOutline.style.borderColor = getComputedStyle(document.documentElement).getPropertyValue('--primary');
    }
}

function initCustomCursor() {
    if (isMobile) {
        cursorDot.style.display = 'none';
        cursorOutline.style.display = 'none';
        return;
    }
    
    document.addEventListener('mousemove', handleMouseMove);
    document.addEventListener('mousedown', handleMouseDown);
    document.addEventListener('mouseup', handleMouseUp);
    document.addEventListener('mouseenter', handleMouseEnter);
    document.addEventListener('mouseleave', handleMouseLeave);
    
    function animate() {
        updateCursor();
        requestAnimationFrame(animate);
    }
    animate();
}

// =============== UTILITY FUNCTIONS ===============
function showNotification(message, type = 'info') {
    const notification = document.getElementById('notification');
    notification.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
        <span>${message}</span>
    `;
    notification.className = `notification show ${type}`;
    
    setTimeout(() => {
        notification.classList.remove('show');
    }, 3000);
}

function formatNumber(num) {
    if (num >= 1000000) {
        return (num / 1000000).toFixed(1) + 'M';
    } else if (num >= 1000) {
        return (num / 1000).toFixed(1) + 'K';
    }
    return num.toString();
}

function formatDuration(seconds) {
    if (!seconds) return '--:--';
    const hrs = Math.floor(seconds / 3600);
    const mins = Math.floor((seconds % 3600) / 60);
    const secs = Math.floor(seconds % 60);
    
    if (hrs > 0) {
        return `${hrs}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }
    return `${mins}:${secs.toString().padStart(2, '0')}`;
}

function formatRelativeTime(dateString) {
    const date = new Date(dateString);
    const now = new Date();
    const diffMs = now - date;
    const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
    
    if (diffDays === 0) return 'Today';
    if (diffDays === 1) return 'Yesterday';
    if (diffDays < 7) return `${diffDays} days ago`;
    if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
    return date.toLocaleDateString();
}

function formatFileSize(bytes) {
    if (bytes >= 1000000000) {
        return (bytes / 1000000000).toFixed(1) + ' GB';
    } else if (bytes >= 1000000) {
        return (bytes / 1000000).toFixed(1) + ' MB';
    } else if (bytes >= 1000) {
        return (bytes / 1000).toFixed(1) + ' KB';
    }
    return bytes + ' B';
}

// =============== HEADER SCROLL EFFECT ===============
function initHeaderScroll() {
    let lastScroll = 0;
    const header = document.querySelector('.header');
    
    window.addEventListener('scroll', () => {
        const currentScroll = window.pageYOffset;
        
        if (currentScroll <= 0) {
            header.classList.remove('hidden');
            return;
        }
        
        if (currentScroll > lastScroll && !header.classList.contains('hidden')) {
            // Scrolling down
            header.classList.add('hidden');
        } else if (currentScroll < lastScroll && header.classList.contains('hidden')) {
            // Scrolling up
            header.classList.remove('hidden');
        }
        
        lastScroll = currentScroll;
    });
}

// =============== FIXED SEARCH FUNCTION ===============
async function handleSearch() {
    const query = document.getElementById('searchInput').value.trim();
    console.log(' Search query:', query);
    
    if (query) {
        showNotification(`Searching for: ${query}`, 'info');
        // Clear current videos and load search results
        await loadVideos(true, query);
    } else {
        showNotification('Please enter a search term', 'info');
    }
}

// =============== FIXED HOME BUTTON ===============
function handleHomeClick() {
    // Hide upload section, show videos
    document.getElementById('uploadSection').style.display = 'none';
    document.getElementById('videosSection').style.display = 'block';
    
    // Clear search input
    document.getElementById('searchInput').value = '';
    
    // Reset sort to default
    document.getElementById('sortVideos').value = 'newest';
    
    // Reload videos
    loadVideos(true);
    
    // Update active state
    document.querySelectorAll('.sidebar-item').forEach(item => {
        item.classList.remove('active');
    });
    document.getElementById('homeBtn').classList.add('active');
    
    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// =============== MOBILE AUTOPLAY ===============
function initMobileObserver() {
    if (!isMobile || !('IntersectionObserver' in window)) return;
    
    observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            const video = entry.target;
            if (entry.isIntersecting) {
                video.play().catch(() => {
                    console.log('Autoplay blocked on mobile');
                });
            } else {
                video.pause();
            }
        });
    }, {
        threshold: 0.5,
        rootMargin: '50px'
    });
}

function setupMobileVideoCards() {
    if (!isMobile) return;
    
    document.querySelectorAll('.video-card video').forEach(video => {
        video.muted = true;
        video.playsInline = true;
        if (observer) observer.observe(video);
    });
}

// =============== REAL-TIME POLLING ===============
function startRealTimePolling() {
    if (pollingInterval) clearInterval(pollingInterval);
    
    pollingInterval = setInterval(async () => {
        if (!videosCache || videosCache.length === 0) return;
        
        try {
            const videoIds = videosCache.map(v => v.id).join(',');
            const response = await fetch(
                `/api/view-videos?statsOnly=true&ids=${videoIds}&since=${lastUpdateCheck}`,
                { credentials: 'include' }
            );
            
            if (response.ok) {
                const updates = await response.json();
                if (updates && updates.length > 0) {
                    updates.forEach(update => {
                        updateVideoStatsInUI(update);
                    });
                }
                lastUpdateCheck = Date.now();
            }
        } catch (err) {
            console.error('Polling error:', err);
        }
    }, POLLING_INTERVAL);
}

function updateVideoStatsInUI(stats) {
    const videoElement = document.querySelector(`.video-card[data-video-id="${stats.id}"]`);
    if (!videoElement) return;
    
    // Update views
    const viewsElement = videoElement.querySelector('.video-stats span:first-child');
    if (viewsElement && stats.views !== undefined) {
        viewsElement.textContent = `${formatNumber(stats.views)} views`;
    }
}

// =============== USER MANAGEMENT ===============
async function loadCurrentUser() {
    try {
        const res = await fetch('/api/me', { credentials: 'include' });
        if (res.ok) {
            const data = await res.json();
            if (data.authenticated) {
                currentUser = data.user;
                updateUserUI();
            }
        }
    } catch (err) {
        console.error('Failed to load user:', err);
    }
}

function updateUserUI() {
    if (currentUser) {
        const avatarUrl = currentUser.avatar_url || currentUser.profile_picture || 
            `https://ui-avatars.com/api/?name=${encodeURIComponent(currentUser.username || currentUser.email)}&background=random`;
        
        document.getElementById('userAvatar').src = avatarUrl;
        document.getElementById('commentAvatar').src = avatarUrl;
        
        document.getElementById('dropdownHeader').innerHTML = `
            <h3>${currentUser.username || currentUser.email}</h3>
            <p>${currentUser.email}</p>
        `;
        
        document.getElementById('logoutBtn').style.display = 'block';
        document.getElementById('loginBtn').style.display = 'none';
        
        // Enable comment form
        document.getElementById('commentInput').placeholder = "Add a comment...";
        document.getElementById('commentSubmitBtn').disabled = false;
    } else {
        document.getElementById('logoutBtn').style.display = 'none';
        document.getElementById('loginBtn').style.display = 'block';
        
        // Disable comment form
        document.getElementById('commentInput').placeholder = "Sign in to comment";
        document.getElementById('commentSubmitBtn').disabled = true;
    }
}

async function logout() {
    try {
        const res = await fetch('/api/logout', {
            method: 'POST',
            credentials: 'include'
        });
        
        if (res.ok) {
            currentUser = null;
            userDropdown.classList.remove('show');
            updateUserUI();
            showNotification('Logged out successfully', 'success');
            loadVideos(true);
        }
    } catch (err) {
        showNotification('Logout failed', 'error');
    }
}

// =============== VIDEO UPLOAD ===============
function setupUploadHandlers() {
    const uploadArea = document.getElementById('uploadArea');
    const videoFileInput = document.getElementById('videoFile');
    const selectFileBtn = document.getElementById('selectFileBtn');
    const clearFileBtn = document.getElementById('clearFileBtn');
    const uploadForm = document.getElementById('uploadForm');
    
    // Drag and drop
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });
    
    uploadArea.addEventListener('dragleave', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            handleVideoSelect(files[0]);
        }
    });
    
    // File selection
    selectFileBtn.addEventListener('click', () => {
        videoFileInput.click();
    });
    
    videoFileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            handleVideoSelect(e.target.files[0]);
        }
    });
    
    // Clear file
    clearFileBtn.addEventListener('click', () => {
        videoFileInput.value = '';
        document.getElementById('fileInfo').style.display = 'none';
        showNotification('File cleared', 'info');
    });
    
    // Form submission
    uploadForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        await handleUpload();
    });
}

function handleVideoSelect(file) {
    if (!file.type.startsWith('video/')) {
        showNotification('Please select a video file', 'error');
        return;
    }
    
    if (file.size > 500 * 1024 * 1024) {
        showNotification('File size must be less than 500MB', 'error');
        return;
    }
    
    const fileInfo = document.getElementById('fileInfo');
    document.getElementById('fileName').textContent = file.name;
    document.getElementById('fileSize').textContent = formatFileSize(file.size);
    fileInfo.style.display = 'block';
    showNotification('Video file selected', 'success');
}

async function handleUpload() {
    if (!currentUser) {
        showNotification('Please sign in to upload videos', 'error');
        return;
    }
    
    const videoFile = document.getElementById('videoFile').files[0];
    const title = document.getElementById('videoTitle').value.trim();
    
    if (!videoFile) {
        showNotification('Please select a video file', 'error');
        return;
    }
    
    if (!title) {
        showNotification('Please enter a video title', 'error');
        return;
    }
    
    const formData = new FormData();
    formData.append('video', videoFile);
    formData.append('title', title);
    formData.append('description', document.getElementById('videoDescription').value.trim());
    formData.append('category', document.getElementById('videoCategory').value);
    formData.append('privacy', document.getElementById('videoPrivacy').value);
    formData.append('tags', document.getElementById('videoTags').value);
    formData.append('settings', JSON.stringify({
        allowComments: document.getElementById('allowComments').checked,
        allowRatings: document.getElementById('allowRatings').checked,
        showViewCount: document.getElementById('showViewCount').checked,
        aiGenerated: document.getElementById('aiGenerated').checked
    }));
    
    try {
        showNotification('Uploading video...', 'info');
        
        const response = await fetch('/api/upload-video', {
            method: 'POST',
            body: formData,
            credentials: 'include'
        });
        
        if (response.ok) {
            const result = await response.json();
            showNotification('Video uploaded successfully!', 'success');
            closeUploadModal();
            document.getElementById('fileInfo').style.display = 'none';
            document.getElementById('uploadForm').reset();
            loadVideos(true);
        } else {
            const error = await response.text();
            showNotification(`Upload failed: ${error}`, 'error');
        }
    } catch (error) {
        showNotification(`Upload error: ${error.message}`, 'error');
    }
}

function closeUploadModal() {
    document.getElementById('uploadSection').style.display = 'none';
    document.getElementById('videosSection').style.display = 'block';
    handleHomeClick();
}

// =============== VIDEO LOADING & DISPLAY ===============
async function loadVideos(reset = false, searchQuery = '') {
    const videosList = document.getElementById('videosList');
    
    if (reset) {
        displayedVideos = 0;
        videosList.innerHTML = `
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading videos...</p>
            </div>
        `;
    }
    
    try {
        const sortBy = document.getElementById('sortVideos').value;
        let url = `/api/view-videos?sort=${sortBy}&limit=${VIDEOS_PER_PAGE}&offset=${displayedVideos}`;
        
        if (searchQuery) {
            url += `&search=${encodeURIComponent(searchQuery)}`;
            showNotification(`Searching for "${searchQuery}"...`, 'info');
        }
        
        console.log(' Fetching videos from:', url);
        const response = await fetch(url, { credentials: 'include' });
        
        if (!response.ok) {
            throw new Error(`Failed to load videos: ${response.status}`);
        }
        
        const videos = await response.json();
        console.log(` Loaded ${videos.length} videos`);
        
        if (reset) {
            videosCache = videos;
            videosList.innerHTML = '';
        } else {
            videosCache = [...videosCache, ...videos];
        }
        
        if (videos.length === 0) {
            if (reset) {
                videosList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-video-slash"></i>
                        <h3>No videos found</h3>
                        <p>${searchQuery ? 'Try a different search term' : 'Be the first to upload a video!'}</p>
                    </div>
                `;
            }
            document.getElementById('loadMoreContainer').style.display = 'none';
            return;
        }
        
        renderVideos(videos, reset);
        displayedVideos += videos.length;
        
        document.getElementById('loadMoreContainer').style.display = 
            videos.length === VIDEOS_PER_PAGE ? 'block' : 'none';
        
        // Setup mobile autoplay
        if (isMobile) {
            setupMobileVideoCards();
        }
        
        // Start real-time polling
        if (!pollingInterval) {
            startRealTimePolling();
        }
        
    } catch (error) {
        console.error(' Load videos error:', error);
        showNotification(`Failed to load videos: ${error.message}`, 'error');
        videosList.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>Failed to load videos</h3>
                <p>Please try again later</p>
            </div>
        `;
    }
}

function renderVideos(videos, reset = false) {
    const videosList = document.getElementById('videosList');
    
    if (reset) videosList.innerHTML = '';
    
    videos.forEach(video => {
        const videoCard = document.createElement('div');
        videoCard.className = 'video-card parallax-card';
        videoCard.setAttribute('data-video-id', video.id);
        
        const thumbnail = video.cover_url || 'https://images.unsplash.com/photo-1611605698335-8b1569810435?w=800&h=450&fit=crop';
        const duration = video.duration ? formatDuration(video.duration) : '--:--';
        const views = video.views ? formatNumber(video.views) : '0';
        const uploadTime = video.uploaded_at ? formatRelativeTime(video.uploaded_at) : 
                          (video.created_at ? formatRelativeTime(video.created_at) : 'Recently');
        
        const userAvatar = video.user?.avatar_url || video.user?.profile_picture || 
            `https://ui-avatars.com/api/?name=${encodeURIComponent(video.user?.username || video.user?.email || 'User')}&background=random`;
        
        videoCard.innerHTML = `
            <div class="video-thumbnail">
                <img src="${thumbnail}" alt="${video.title || 'Video'}" 
                     onerror="this.src='https://images.unsplash.com/photo-1611605698335-8b1569810435?w=800&h=450&fit=crop'">
                <span class="video-duration">${duration}</span>
            </div>
            <div class="video-info">
                <img src="${userAvatar}" 
                     alt="${video.user?.username || 'User'}" 
                     class="channel-avatar"
                     onerror="this.src='https://ui-avatars.com/api/?name=User&background=random'">
                <div class="video-content">
                    <h3 class="video-title">${video.title || 'Untitled Video'}</h3>
                    <p class="channel-name">${video.user?.username || video.user?.email?.split('@')[0] || 'User'}</p>
                    <div class="video-stats">
                        <span>${views} views</span>
                        
                        <span>${uploadTime}</span>
                        ${video.ai_generated ? ' <span><i class="fas fa-robot"></i> AI</span>' : ''}
                    </div>
                </div>
            </div>
        `;
        
        videoCard.addEventListener('click', () => openVideoModal(video));
        
        // Add animation delay for staggered appearance
        videoCard.style.animationDelay = `${Math.random() * 0.3}s`;
        
        videosList.appendChild(videoCard);
    });
}

// =============== VIDEO MODAL ===============
async function openVideoModal(video) {
    currentVideo = video;
    const modal = document.getElementById('videoModal');
    const player = document.getElementById('modalVideo');
    
    console.log(' Opening video modal:', video.id);
    
    // Set video player
    if (video.video_url) {
        player.src = video.video_url;
    }
    
    // Set poster
    if (video.cover_url) {
        player.poster = video.cover_url;
    }
    
    // Set video info
    document.getElementById('modalVideoTitle').textContent = video.title || 'Untitled Video';
    
    const uploadTime = video.uploaded_at || video.created_at;
    document.getElementById('modalVideoMeta').innerHTML = `
        <span>${formatNumber(video.views || 0)} views</span>
        
        <span>${uploadTime ? formatRelativeTime(uploadTime) : 'Recently'}</span>
        ${video.ai_generated ? ' <span><i class="fas fa-robot"></i> AI Generated</span>' : ''}
    `;
    
    // Set description
    const descShort = document.getElementById('videoDescriptionShort');
    const descFull = document.getElementById('videoDescriptionFull');
    const toggleBtn = document.getElementById('descriptionToggleBtn');
    
    if (video.description) {
        const shortText = video.description.substring(0, 200);
        descShort.textContent = shortText;
        descFull.textContent = video.description;
        
        if (video.description.length > 200) {
            toggleBtn.style.display = 'inline-block';
            toggleBtn.textContent = 'Show more';
            toggleBtn.onclick = toggleDescription;
        } else {
            toggleBtn.style.display = 'none';
        }
    } else {
        descShort.textContent = 'No description provided';
        descFull.textContent = '';
        toggleBtn.style.display = 'none';
    }
    
    // Load likes
    if (currentUser) {
        updateLikeButton({
            likes: video.likes || 0,
            liked: video.hasLiked || false
        });
    } else {
        updateLikeButton({
            likes: video.likes || 0,
            liked: false
        });
    }
    
    // Load comments from video data
    await loadComments(true, video.comments || []);
    
    // Load recommended videos
    await loadRecommendedVideos();
    
    // Show modal
    modal.classList.add('show');
    document.body.style.overflow = 'hidden';
    
    // Play video
    player.play().catch((error) => {
        console.log('Video play failed:', error.message);
        showNotification('Click play to start video', 'info');
    });
    
    // Track view
    await trackView(video.id);
}

function closeVideoModal() {
    const modal = document.getElementById('videoModal');
    const player = document.getElementById('modalVideo');
    
    player.pause();
    player.src = '';
    player.poster = '';
    modal.classList.remove('show');
    document.body.style.overflow = '';
    currentVideo = null;
}

function toggleDescription() {
    const short = document.getElementById('videoDescriptionShort');
    const full = document.getElementById('videoDescriptionFull');
    const toggleBtn = document.getElementById('descriptionToggleBtn');
    
    if (full.style.display === 'none') {
        short.style.display = 'none';
        full.style.display = 'block';
        toggleBtn.textContent = 'Show less';
    } else {
        short.style.display = 'block';
        full.style.display = 'none';
        toggleBtn.textContent = 'Show more';
    }
}

// =============== COMMENTS LOADING ===============
async function loadComments(reset = false, videoComments = null) {
    if (!currentVideo && !videoComments) return;
    
    const commentsList = document.getElementById('commentsList');
    
    if (reset) {
        commentsCache[currentVideo.id] = { comments: [], page: 0, total: 0 };
        commentsList.innerHTML = `
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading comments...</p>
            </div>
        `;
    }
    
    try {
        const comments = videoComments || currentVideo.comments || [];
        
        document.getElementById('commentsCount').textContent = `${formatNumber(comments.length)} Comments`;
        
        if (comments.length === 0 && reset) {
            commentsList.innerHTML = `
                <div style="text-align: center; padding: 48px; color: var(--text-tertiary);">
                    <i class="fas fa-comment-slash" style="font-size: 24px; margin-bottom: 16px;"></i>
                    <h3>No comments yet</h3>
                    <p>Be the first to comment!</p>
                </div>
            `;
            document.getElementById('loadMoreComments').style.display = 'none';
            return;
        }
        
        renderComments(comments, reset);
        document.getElementById('loadMoreComments').style.display = 'none';
        
    } catch (error) {
        console.error('Load comments error:', error);
        showNotification(`Failed to load comments: ${error.message}`, 'error');
        commentsList.innerHTML = `
            <div style="text-align: center; padding: 48px; color: var(--text-tertiary);">
                <i class="fas fa-exclamation-triangle" style="font-size: 24px; margin-bottom: 16px;"></i>
                <h3>Failed to load comments</h3>
            </div>
        `;
    }
}

function renderComments(comments, reset = false) {
    const commentsList = document.getElementById('commentsList');
    
    if (reset) commentsList.innerHTML = '';
    
    comments.forEach((comment, index) => {
        const commentDiv = document.createElement('div');
        commentDiv.className = 'comment-item';
        commentDiv.setAttribute('data-comment-id', comment.id);
        
        const userAvatar = comment.user?.avatar_url || comment.user?.profile_picture || 
            `https://ui-avatars.com/api/?name=${encodeURIComponent(comment.user?.username || comment.user?.email || 'User')}&background=random`;
        
        commentDiv.innerHTML = `
            <img src="${userAvatar}" alt="${comment.user?.username || 'User'}" 
                 class="comment-avatar"
                 onerror="this.src='https://ui-avatars.com/api/?name=User&background=random'">
            <div class="comment-content">
                <div class="comment-header">
                    <span class="comment-author">${comment.user?.username || 'User'}</span>
                    <span class="comment-time">${formatRelativeTime(comment.created_at)}</span>
                </div>
                <div class="comment-text">${comment.text || ''}</div>
                <div class="comment-actions">
                    <button class="comment-like" onclick="likeComment('${comment.id}', ${comment.hasLiked || false})">
                        <i class="${comment.hasLiked ? 'fas' : 'far'} fa-thumbs-up"></i>
                        <span>${formatNumber(comment.likes || 0)}</span>
                    </button>
                    <button class="comment-reply">
                        Reply
                    </button>
                </div>
            </div>
        `;
        
        // Stagger animation
        commentDiv.style.animationDelay = `${index * 0.1}s`;
        
        commentsList.appendChild(commentDiv);
    });
}

// =============== LIKES ===============
async function toggleLike() {
    if (!currentVideo || !currentUser) {
        showNotification('Please sign in to like videos', 'error');
        return;
    }
    
    try {
        const response = await fetch('/api/like-video', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify({
                videoId: currentVideo.id,
                action: currentVideo.hasLiked ? 'unlike' : 'like'
            })
        });
        
        if (response.ok) {
            const data = await response.json();
            currentVideo.hasLiked = data.liked;
            currentVideo.likes = data.likes;
            updateLikeButton(data);
            showNotification(data.liked ? 'Video liked!' : 'Video unliked', 'success');
        }
    } catch (error) {
        showNotification('Failed to update like', 'error');
    }
}

function updateLikeButton(data) {
    const likeBtn = document.getElementById('likeBtn');
    const likeCount = document.getElementById('likeCount');
    
    likeCount.textContent = formatNumber(data.likes || 0);
    
    if (data.liked) {
        likeBtn.innerHTML = `<i class="fas fa-thumbs-up"></i> <span id="likeCount">${likeCount.textContent}</span>`;
        likeBtn.classList.add('liked');
        likeBtn.classList.add('pulse');
        setTimeout(() => likeBtn.classList.remove('pulse'), 2000);
    } else {
        likeBtn.innerHTML = `<i class="far fa-thumbs-up"></i> <span id="likeCount">${likeCount.textContent}</span>`;
        likeBtn.classList.remove('liked');
    }
}

// =============== POST COMMENT ===============
async function postComment() {
    if (!currentVideo || !currentUser) {
        showNotification('Please sign in to comment', 'error');
        return;
    }
    
    const commentInput = document.getElementById('commentInput');
    const text = commentInput.value.trim();
    
    if (!text) {
        showNotification('Comment cannot be empty', 'error');
        return;
    }
    
    try {
        const response = await fetch(`/api/view-videos?videoId=${currentVideo.id}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify({ text })
        });
        
        if (response.ok) {
            const comment = await response.json();
            commentInput.value = '';
            
            // Add comment to UI
            const commentsList = document.getElementById('commentsList');
            const commentDiv = document.createElement('div');
            commentDiv.className = 'comment-item';
            commentDiv.setAttribute('data-comment-id', comment.id);
            
            const userAvatar = currentUser.avatar_url || currentUser.profile_picture || 
                `https://ui-avatars.com/api/?name=${encodeURIComponent(currentUser.username || currentUser.email)}&background=random`;
            
            commentDiv.innerHTML = `
                <img src="${userAvatar}" alt="${currentUser.username || 'User'}" class="comment-avatar">
                <div class="comment-content">
                    <div class="comment-header">
                        <span class="comment-author">${currentUser.username || 'User'}</span>
                        <span class="comment-time">Just now</span>
                    </div>
                    <div class="comment-text">${text}</div>
                    <div class="comment-actions">
                        <button class="comment-like">
                            <i class="far fa-thumbs-up"></i>
                            <span>0</span>
                        </button>
                        <button class="comment-reply">
                            Reply
                        </button>
                    </div>
                </div>
            `;
            
            commentsList.insertBefore(commentDiv, commentsList.firstChild);
            
            // Update comment count
            const commentsCount = document.getElementById('commentsCount');
            const currentCount = parseInt(commentsCount.textContent) || 0;
            commentsCount.textContent = `${formatNumber(currentCount + 1)} Comments`;
            
            showNotification('Comment posted!', 'success');
        }
    } catch (error) {
        showNotification('Failed to post comment', 'error');
    }
}

// =============== LIKE COMMENT ===============
async function likeComment(commentId, isLiked) {
    if (!currentUser) {
        showNotification('Please sign in to like comments', 'error');
        return;
    }
    
    try {
        const response = await fetch(`/api/like-video`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify({
                commentId: commentId,
                action: isLiked ? 'unlike' : 'like'
            })
        });
        
        if (response.ok) {
            const data = await response.json();
            const commentDiv = document.querySelector(`.comment-item[data-comment-id="${commentId}"]`);
            if (commentDiv) {
                const likeBtn = commentDiv.querySelector('.comment-like');
                const likeCount = commentDiv.querySelector('.comment-like span');
                
                if (likeBtn && likeCount) {
                    likeBtn.classList.toggle('liked', data.liked);
                    likeBtn.innerHTML = `<i class="${data.liked ? 'fas' : 'far'} fa-thumbs-up"></i> <span>${formatNumber(data.likes)}</span>`;
                }
            }
        }
    } catch (error) {
        showNotification('Failed to like comment', 'error');
    }
}

// =============== OTHER FUNCTIONS ===============
async function loadRecommendedVideos() {
    const recommendedVideos = document.getElementById('recommendedVideos');
    recommendedVideos.innerHTML = `
        <div style="text-align: center; padding: 20px; color: var(--text-tertiary);">
            <p>Recommended videos will appear here</p>
        </div>
    `;
}

async function trackView(videoId) {
    try {
        await fetch(`/api/view-videos?videoId=${videoId}&incrementViews=true`, {
            method: 'GET',
            credentials: 'include'
        });
    } catch (error) {
        console.error('Failed to track view:', error);
    }
}

function openSettings() {
    showNotification('Settings feature coming soon!', 'info');
}

function shareVideo() {
    if (navigator.share) {
        navigator.share({
            title: currentVideo.title || 'Check out this video',
            text: 'Watch this video on Vibro.x',
            url: window.location.href
        });
    } else {
        navigator.clipboard.writeText(window.location.href).then(() => {
            showNotification('Link copied to clipboard!', 'success');
        }).catch(() => {
            showNotification('Failed to copy link', 'error');
        });
    }
}

// =============== TAB HANDLERS ===============
function setupTabHandlers() {
    // Home tab
    document.getElementById('homeBtn').addEventListener('click', (e) => {
        e.preventDefault();
        handleTabClick('homeBtn', 'home');
    });
    
    // Trending tab
    document.getElementById('trendingBtn').addEventListener('click', (e) => {
        e.preventDefault();
        handleTabClick('trendingBtn', 'trending');
    });
    
    // History tab
    document.getElementById('historyBtn').addEventListener('click', (e) => {
        e.preventDefault();
        handleTabClick('historyBtn', 'history');
    });
    
    // Liked videos tab
    document.getElementById('likedBtn').addEventListener('click', (e) => {
        e.preventDefault();
        handleTabClick('likedBtn', 'liked');
    });
    
    // Your videos tab
    document.getElementById('yourVideosBtn').addEventListener('click', (e) => {
        e.preventDefault();
        handleTabClick('yourVideosBtn', 'your-videos');
    });
    
    // Watch later tab
    document.getElementById('watchLaterBtn').addEventListener('click', (e) => {
        e.preventDefault();
        handleTabClick('watchLaterBtn', 'watch-later');
    });
}

async function handleTabClick(tabId, viewType) {
    console.log(` Switching to ${viewType} view`);
    
    // Update active state
    document.querySelectorAll('.sidebar-item').forEach(item => {
        item.classList.remove('active');
    });
    document.getElementById(tabId).classList.add('active');
    
    // Hide upload section if visible
    document.getElementById('uploadSection').style.display = 'none';
    document.getElementById('videosSection').style.display = 'block';
    
    // Clear search input
    document.getElementById('searchInput').value = '';
    
    // Update page title
    const pageTitles = {
        'home': 'Recommended Videos',
        'trending': 'Trending Videos',
        'history': 'Watch History',
        'liked': 'Liked Videos',
        'your-videos': 'Your Videos',
        'watch-later': 'Watch Later'
    };
    
    document.querySelector('#videosSection h2').textContent = pageTitles[viewType] || 'Videos';
    
    // Load videos for this view
    await loadVideosForView(viewType);
}

async function loadVideosForView(viewType, reset = true, searchQuery = '') {
    const videosList = document.getElementById('videosList');
    
    if (reset) {
        displayedVideos = 0;
        videosList.innerHTML = `
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading ${viewType} videos...</p>
            </div>
        `;
    }
    
    try {
        const sortBy = document.getElementById('sortVideos').value;
        let url = `/api/view-videos?view=${viewType}&sort=${sortBy}&limit=${VIDEOS_PER_PAGE}&offset=${displayedVideos}`;
        
        if (searchQuery) {
            url += `&search=${encodeURIComponent(searchQuery)}`;
        }
        
        console.log(` Fetching ${viewType} videos from:`, url);
        const response = await fetch(url, { credentials: 'include' });
        
        if (!response.ok) {
            if (response.status === 401) {
                const errorData = await response.json();
                videosList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-lock"></i>
                        <h3>Authentication Required</h3>
                        <p>${errorData.error || 'Please sign in to view this content'}</p>
                        <button class="btn-primary" onclick="window.location.href='/login'" style="margin-top: 16px;">
                            <i class="fas fa-sign-in-alt"></i>
                            Sign In
                        </button>
                    </div>
                `;
                return;
            }
            
            throw new Error(`Failed to load videos: ${response.status}`);
        }
        
        const videos = await response.json();
        console.log(` Loaded ${videos.length} ${viewType} videos`);
        
        if (reset) {
            videosCache = videos;
            videosList.innerHTML = '';
        } else {
            videosCache = [...videosCache, ...videos];
        }
        
        if (videos.length === 0) {
            if (reset) {
                const emptyMessages = {
                    'home': 'No videos found. Be the first to upload!',
                    'trending': 'No trending videos yet',
                    'history': 'No watch history found',
                    'liked': 'No liked videos yet',
                    'your-videos': 'You haven\'t uploaded any videos yet',
                    'watch-later': 'No videos in watch later'
                };
                
                videosList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-video-slash"></i>
                        <h3>No videos found</h3>
                        <p>${emptyMessages[viewType] || 'Try a different view or upload a video'}</p>
                        ${viewType === 'your-videos' ? `
                            <button class="btn-primary" id="uploadFromEmptyBtn" style="margin-top: 16px;">
                                <i class="fas fa-upload"></i>
                                Upload Your First Video
                            </button>
                        ` : ''}
                    </div>
                `;
                
                if (viewType === 'your-videos') {
                    document.getElementById('uploadFromEmptyBtn').addEventListener('click', () => {
                        document.getElementById('uploadBtn').click();
                    });
                }
            }
            document.getElementById('loadMoreContainer').style.display = 'none';
            return;
        }
        
        renderVideos(videos, reset);
        displayedVideos += videos.length;
        
        document.getElementById('loadMoreContainer').style.display = 
            videos.length === VIDEOS_PER_PAGE ? 'block' : 'none';
        
        if (isMobile) {
            setupMobileVideoCards();
        }
        
        if (!pollingInterval) {
            startRealTimePolling();
        }
        
    } catch (error) {
        console.error(` Load ${viewType} videos error:`, error);
        showNotification(`Failed to load ${viewType} videos: ${error.message}`, 'error');
        videosList.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-exclamation-triangle"></i>
                <h3>Failed to load videos</h3>
                <p>Please try again later</p>
            </div>
        `;
    }
}

// Update the loadVideos function to use the new view-based loading
async function loadVideos(reset = false, searchQuery = '') {
    const activeTab = document.querySelector('.sidebar-item.active');
    let viewType = 'home';
    
    if (activeTab) {
        const tabMap = {
            'homeBtn': 'home',
            'trendingBtn': 'trending',
            'historyBtn': 'history',
            'likedBtn': 'liked',
            'yourVideosBtn': 'your-videos',
            'watchLaterBtn': 'watch-later'
        };
        
        viewType = tabMap[activeTab.id] || 'home';
    }
    
    await loadVideosForView(viewType, reset, searchQuery);
}

// =============== INITIALIZATION ===============
document.addEventListener('DOMContentLoaded', async () => {
    // Initialize custom cursor
    initCustomCursor();
    
    // Initialize header scroll effect
    initHeaderScroll();
    
    // Setup event listeners
    document.getElementById('userAvatar').addEventListener('click', () => {
        document.getElementById('userDropdown').classList.toggle('show');
    });
    
    // Logo button
    document.getElementById('logoBtn').addEventListener('click', (e) => {
        e.preventDefault();
        handleHomeClick();
    });
    
    // Home button
    document.getElementById('homeBtn').addEventListener('click', (e) => {
        e.preventDefault();
        handleHomeClick();
    });
    
    // Upload button
    document.getElementById('uploadBtn').addEventListener('click', () => {
        document.getElementById('uploadSection').style.display = 'block';
        document.getElementById('videosSection').style.display = 'none';
        
        document.querySelectorAll('.sidebar-item').forEach(item => {
            item.classList.remove('active');
        });
    });
    
    // Cancel upload
    document.getElementById('cancelUploadBtn').addEventListener('click', () => {
        closeUploadModal();
    });
    
    // Close modal
    document.getElementById('closeModalBtn').addEventListener('click', closeVideoModal);
    
    // Like button
    document.getElementById('likeBtn').addEventListener('click', toggleLike);
    
    // Share button
    document.getElementById('shareBtn').addEventListener('click', shareVideo);
    
    // Comment submit
    document.getElementById('commentSubmitBtn').addEventListener('click', postComment);
    
    // Enter key in comment input
    document.getElementById('commentInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            postComment();
        }
    });
    
    // Load more videos
    document.getElementById('loadMoreBtn').addEventListener('click', () => loadVideos(false));
    
    // Load more comments
    document.getElementById('loadMoreCommentsBtn').addEventListener('click', () => loadComments(false));
    
    // Logout
    document.getElementById('logoutBtn').addEventListener('click', logout);
    
    // Login
    document.getElementById('loginBtn').addEventListener('click', () => window.location.href = '/login');
    
    // Settings
    document.getElementById('settingsBtn').addEventListener('click', openSettings);
    
    // Search button
    document.getElementById('searchButton').addEventListener('click', handleSearch);
    
    // Search input enter key
    document.getElementById('searchInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            handleSearch();
        }
    });
    
    // Sort changes
    document.getElementById('sortVideos').addEventListener('change', async () => {
        const activeTab = document.querySelector('.sidebar-item.active');
        let viewType = 'home';
        
        if (activeTab) {
            const tabMap = {
                'homeBtn': 'home',
                'trendingBtn': 'trending',
                'historyBtn': 'history',
                'likedBtn': 'liked',
                'yourVideosBtn': 'your-videos',
                'watchLaterBtn': 'watch-later'
            };
            
            viewType = tabMap[activeTab.id] || 'home';
        }
        
        await loadVideosForView(viewType, true);
    });
    
    document.getElementById('commentsSort').addEventListener('change', () => loadComments(true));
    
    // Close modals on outside click
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.user-menu') && document.getElementById('userDropdown').classList.contains('show')) {
            document.getElementById('userDropdown').classList.remove('show');
        }
        
        if (e.target.classList.contains('video-modal')) {
            closeVideoModal();
        }
    });
    
    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            closeVideoModal();
            if (document.getElementById('uploadSection').style.display !== 'none') {
                closeUploadModal();
            }
        }
        if (e.key === '/' && !e.target.matches('input, textarea')) {
            e.preventDefault();
            document.getElementById('searchInput').focus();
        }
    });
    
    // Setup tab handlers
    setupTabHandlers();
    
    // Setup upload handlers
    setupUploadHandlers();
    
    // Initialize mobile autoplay
    initMobileObserver();
    
    // Load data
    await loadCurrentUser();
    await loadVideos(true);
    
    // Clean up on page unload
    window.addEventListener('beforeunload', () => {
        if (pollingInterval) {
            clearInterval(pollingInterval);
        }
        if (observer) {
            observer.disconnect();
        }
    });
    
    // Add subtle parallax effect on mouse move
    document.addEventListener('mousemove', (e) => {
        if (isMobile) return;
        
        const x = (window.innerWidth - e.pageX * 2) / 100;
        const y = (window.innerHeight - e.pageY * 2) / 100;
        
        document.querySelectorAll('.video-card').forEach(card => {
            card.style.transform = `translateY(-8px) scale(1.02) rotateY(${x}deg) rotateX(${y}deg)`;
        });
    });
});
</script>
</body>
</html>
